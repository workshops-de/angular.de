<!DOCTYPE html>
<html lang="de">

<head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# article: http://ogp.me/ns/article#">
  <meta charset="utf-8">
  <link rel="dns-prefetch" href="//www.google-analytics.com">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="keywords" content="">

  <title>Single Sign-on mit OAuth 2 und OpenId Connect | Angular.DE</title>
  
  <meta name="description" content="Dieser Artikel zeigt, wie Token-basierte Sicherheit in einer Angular-Anwendung genutzt werden kann.">
  

  
  <!-- Use canonical_url if available is post -->
  
  <link rel="canonical" href="http://localhost:4000/artikel/oauth-odic-plugin/">
  
  

  

  <!-- Facebook Tags -->

  <meta name="og:title" content="Single Sign-on mit OAuth 2 und OpenId Connect - Angular.DE">



  <meta property="og:description" content="Dieser Artikel zeigt, wie Token-basierte Sicherheit in einer Angular-Anwendung genutzt werden kann.">


<meta property="og:url" content="http://localhost:4000/artikel/oauth-odic-plugin/" />

  <meta property="og:type" content="article" />



  <meta property="og:image" content="http://localhost:4000/opengraph/default.png" />


<!-- Twitter Tags -->
<meta name="twitter:card" content="summary_large_image">


  <meta name="twitter:title" content="Single Sign-on mit OAuth 2 und OpenId Connect - Angular.DE">


<meta name="twitter:site" content="@angular_de">
<meta name="twitter:creator" content="@angular_de">

  <meta name="twitter:description" content="Dieser Artikel zeigt, wie Token-basierte Sicherheit in einer Angular-Anwendung genutzt werden kann.">


  <meta name="twitter:image" content="http://localhost:4000/artikel/oauth-odic-plugin/header.jpg">



  <link rel="icon" href="/assets/img/favicon.ico?v=2" type="image/x-icon" />
  <link rel="stylesheet" href="/assets/css/app.css?1750255920177315000">
  
  <script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Organization",
  "url": "http://localhost:4000",
  "logo": "http://localhost:4000/assets/img/logo.svg",
  "sameAs":[
    "https://twitter.com/angular_de"
  ]
}
</script>
  
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "http://localhost:4000"
    },
    
      
    {
      "@type": "ListItem",
      "position": 2,
      "name": "Artikel",
      "item": "http://localhost:4000/artikel/"
    },
      
    
      
    {
      "@type": "ListItem",
      "position": 3,
      "name": "Single Sign-on mit OAuth 2 und OpenId Connect"
    }
      
    
  ]
}
</script>
</head>

<!-- Position relative is for Bootstrap TOC Plugin -->

<body style="position: relative" data-bs-spy="scroll" data-bs-target="#toc">
  <div class="navbar-wrapper">
  
  <div class="navbar-banner">
    <div class="d-flex align-items-center justify-content-center">
      <a href="https://workshops.de/schulungsthemen/angular?utm_source=angular_de&utm_campaign=group_discount&utm_medium=portal&utm_content=banner" target="_blank">Wir bieten einen <b>3=2 Rabatt</b> auf Schulungen an! Buche 2 Teilnehmer:innen und der/die Dritte ist kostenfrei.</a>
    </div>
  </div>



  <nav class="navbar navbar-main navbar-expand-lg">
    <div class="container">
      <a class="navbar-brand p-0 me-4" href="/">
        <img alt="Angular.DE powered by workshops.de" src="/assets/img/logo-with-poweredby.svg" height="45">
      </a>
      <button class="navbar-toggler navbar-toggler-right" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
        aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse mt-3 mt-sm-0" id="navbarNav">
        <ul class="navbar-nav me-auto">
          <li class="nav-item active">
            <a class="nav-link" href="/artikel/">Artikel</a>
          </li>
          <li class="nav-item ">
            <a class="nav-link" href="/artikel/angular-tutorial-deutsch/">Tutorial</a>
          </li>
          <li class="nav-item ">
            <a class="nav-link" href="/schulungen/angular-intensiv/">Schulung</a>
          </li>
          <!-- <li class="nav-item">
            <a class="nav-link" href="https://workshops.de/seminare-schulungen-kurse/angular-lifetime?utm_source=angular_de&utm_campaign=crossmarketing_permanent&utm_medium=portal&utm_content=navigation" target="_blank">Lifetime</a>
          </li>-->
          <li class="nav-item ">
            <a class="nav-link" href="/ng-de-konferenz/">NG-DE Konferenz</a>
          </li>
          <li class="nav-item ">
            <a class="nav-link" href="/team/">Team</a>
          </li>
          <!-- <li class="nav-item">
            <a class="nav-link" href="/discord" target="_blank"><span class="visually-hidden">Community </span>Discord</a>
          </li> -->
          <!-- <li class="nav-item ">
            <a class="nav-link" href="/jobs/">Jobs</a>
          </li> -->
        </ul>
        <form class="form-inline d-none d-lg-inline" action="/suche/" method="GET">
          <input name="q" class="form-control navbar-search" type="search" placeholder="&#xF002;" autocomplete="off">
        </form>
      </div>
    </div><!-- .container -->
  </nav>
</div>


  


<main role="main" class="mt-4">
  <article lang="de" class="container">

    <div class="ratio mb-4" style="--bs-aspect-ratio: 30%;">
      <img src="header.jpg" class="rounded w-100 object-fit-cover" alt="Artikel Header Bild zu Single Sign-on mit OAuth 2 und OpenId Connect" />
    </div>
    <div class="row mb-5 gx-6">
      <div class="col-md-12 col-lg-8 mb-2">
        <h1 class="header-post-title">Single Sign-on mit OAuth 2 und OpenId Connect</h1>

        <p class="text-muted">
          <small>
            
            <a href="/kategorie/angular/" class="badge bg-secondary text-bg-secondary text-uppercase">angular</a>
            
            <a href="/kategorie/oauth/" class="badge bg-secondary text-bg-secondary text-uppercase">oAuth</a>
            
            <span class="ms-1 me-1">|</span>
            Manfred Steyer
            
            <a href="https://twitter.com/ManfredSteyer" target="_blank" style="margin-bottom: 5px;">
              <img src="/shared/assets/img/twitter-logo.svg" height="12" alt="Twitter Logo" />
            </a>
            
            
            <span class="ms-1 me-1">‚Ä¢</span> <time>27.07.2020</time>
            <span class="ms-1 me-1">|</span>
            


  14 Minuten


          </small>
        </p>


        <div class="c-content">
          <p>Die wenigsten Gesch√§ftsanwendungen kommen ohne Authentifizierung und Autorisierung aus. H√§ufig m√ºssen bestehende Identity-L√∂sungen wie Active Directory oder LDAP-Systeme integriert werden, um Single-Sign-on zu erm√∂glichen. In modernen Web-Anwendungen muss der Client auch das Recht erhalten, im Namen des angemeldeten Benutzers auf Services zuzugreifen. All diese Anforderungen lassen sich elegant mit Security-Tokens l√∂sen.</p>

<p>Dieser Artikel zeigt, wie Token-basierte Sicherheit in einer Angular-Anwendung genutzt werden kann. Dazu kommen die popul√§ren Standards OAuth 2 und OpenId Connect  sowie die Bibliothek <a href="https://www.npmjs.com/package/angular-oauth2-oidc" rel="noreferrer noopener" target="_blank">angular-oauth2-oidc</a> zum Einsatz. Das verwendete Beispiel findet sich <a href="https://github.com/manfredsteyer/oauth2-oidc-demo" rel="noreferrer noopener" target="_blank">hier</a></p>

<h2 id="oauth-2-und-openid-connect">OAuth 2 und OpenId Connect</h2>

<p>Wer sich heutzutage mit Token-basierter Sicherheit besch√§ftigt, kommt wohl kaum an den beiden popul√§ren Standards <a href="https://oauth.net/2/" rel="noreferrer noopener" target="_blank">OAuth 2</a> und <a href="http://openid.net/connect/" rel="noreferrer noopener" target="_blank">OpenId Connect</a> vorbei. Sie beschreiben unter anderem, wie sich ein Benutzer bei einem verteilten System anmelden kann und wie ein Client das Recht erh√§lt, im Namen des Benutzers Services zu konsumieren. Dazu kommt, dass diese Standards direkt auf HTTPS aufsetzen und sich somit wunderbar f√ºr leichtgewichtige Web API eignen.</p>

<h3 id="oauth-2">OAuth 2</h3>

<p>Die erste Version von OAuth wurde 2006 von Twitter und Ma.gnolia entwickelt. Das Ziel war es, Benutzern die M√∂glichkeit zu geben, einen Teil ihrer Rechte an einen Client weiterzugeben, ohne das eigene Passwort mit ihm zu teilen. Somit k√∂nnen zum Beispiel Anwendungen das Recht erhalten, im Namen des Benutzers Services aufzurufen.</p>

<p>Mittlerweile wird OAuth bzw. dessen Nachfolger OAuth 2 von Gr√∂√üen wie Google, Facebook, Flickr, Microsoft, Salesforce.com oder Yahoo! eingesetzt. Dabei f√§llt auf, dass es zunehmend nicht nur zum Delegieren von Rechten (Autorisierung) sondern auch f√ºr Single-Sign-On-Szenarien (Authentifizierung) eingesetzt wird. So k√∂nnen sich Benutzer zum Beispiel mit ihrem Google-Konto auch bei anderen Webl√∂sungen anmelden. In diesem Fall erh√§lt die betroffene Webl√∂sung das Recht, auf die Profildaten des angemeldeten Google-Benutzers zuzugreifen. Auch andere der zuvor aufgef√ºhrten Unternehmen bieten diese M√∂glichkeit.</p>

<p>Hierzu leitet der Client den Benutzer zur Anmeldung zu einem sogenannten Authorization Server weiter:</p>

<p><img src="./angular-oauth-overview.png" alt="Funktionsweise von OAuth 2 aus der Vogelperspektive"></p>

<p>Dieser Server hat Zugriff auf zentrale Benutzerkonten. Hat sich der Benutzer dort angemeldet, erh√§lt der Client ein sogenanntes Access-Token, das ihm im Namen des Benutzers Zugriff auf Services im Backend ‚Äì sogenannte Ressource Server ‚Äì gibt.</p>

<p>Ein Access-Token informiert den Resource Server unter anderem √ºber den entsprechenden Benutzer sowie √ºber die Rechte, die der Client im Namen des Benutzers wahrnehmen darf. Zus√§tzlich finden sich im Token meist auch Metadaten, wie der Aussteller, das Ausstellungsdatum oder die G√ºltigkeitsdauer.</p>

<p>Diese vom Prinzip her einfache Vorgehensweise hat mehrere Vorteile:</p>

<ul>
  <li>Jeder Benutzer kann ein zentrales Benutzerkonto f√ºr verschiedene Clients und Services nutzen</li>
  <li>Da die Anmeldung beim Authorization Server erfolgt, bekommt der Client das Passwort nicht in die Hand.</li>
  <li>Die Authentifizierung ist vom Client entkoppelt und l√§sst sich somit in bestehende Identity-L√∂sungen integrieren</li>
  <li>Tokens erh√∂hen die Flexibilit√§t. Beispielsweise k√∂nnte ein Service das Token an einen weiteren Service weiterreichen, um zu beweisen, dass er im Namen des Benutzers agiert. Zum Zugriff auf anderen Sicherheits-Dom√§nen kann der Service das Token auch gegen eines f√ºr diese Dom√§ne tauschen.</li>
  <li>Die L√∂sung kommt ohne Cookies aus. Somit kann der Client auch auf Services, die auf anderen Servern laufen (bzw. eine andere Origin haben), zugreifen. Zus√§tzlich schr√§nkt der Verzicht auf Cookies bestimmte Angriffe ein.</li>
</ul>

<p>Das Format des Access-Tokens sowie die Ma√ünahmen, die der Resource Server zum Validieren des Tokens unternimmt, sind von OAuth 2 nicht n√§her beschriebene Implementierungsdetails. H√§ufig kommen digitale Signaturen zum Einsatz, damit der Ressource Server einfach pr√ºfen kann, ob das Token von einem vertrauensw√ºrdigen Authorization Server stammt. Alternativ dazu k√∂nnte das Token auch nur aus einer nicht vorhersehbaren Id bestehen, mit der der Ressource Server sich nochmals an den Authorization Server wendet.</p>

<h3 id="benutzer-mit-openid-connect-authentifizieren">Benutzer mit OpenId Connect authentifizieren</h3>

<p>Als Erg√§nzung zu OAuth 2 definiert OpenId Connect (OIDC) unter anderem, wie der Client Informationen √ºber den Benutzer bekommen kann. Diesen Aspekt deckt OAuth 2 nicht ab, denn selbst das ausgestellte Access Token muss f√ºr den Client nicht lesbar sein. Dazu spezifiziert OIDC unter anderem ein sogenanntes Id-Token, das der Client zus√§tzlich zum Access-Token erhalten kann. W√§hrend das Access-Token zum Zugriff auf das Backend bestimmt ist, kann der Client aus dem Id-Token direkt Informationen √ºber den Benutzer entnehmen (Abbildung 2).</p>

<p><img src="angular-oidc-overview.png" alt="Funktionsweise von OpenId Connect aus Vogelperspektive"></p>

<p>Im Gegensatz zu Access-Tokens bei OAuth 2 ist der Aufbau von Id-Tokens vorgegeben. Es handelt sich dabei immer um ein JSON Web Token (JWT), welches signiert und/oder verschl√ºsselt sein kann. Zus√§tzlich definiert OIDC einen sogenannten Userinfo Endpunkt. Dabei handelt es sich um einen Service, der dem Client weitere Informationen zum aktuellen Benutzer preis gibt, sofern dieser das erhaltene Access-Token vorweisen kann.</p>

<h3 id="json-web-token">JSON Web Token</h3>

<p>Beim durch OpenID Connect beschriebenen Identit√§ts-Token handelt es sich um ein JSON Web Token (JWT). Ein JWT beinhaltet unter anderem ein JSON-basiertes Objekt mit Claims. Dabei handelt es sich um Name/Wert-Paare, die ein Subjekt beschreiben, zum Beispiel einen Benutzer. Daneben existieren Claims, die Informationen √ºber das Token selbst liefern, darunter den Zeitraum, indem das Token g√ºltig ist, oder die Audience des Tokens. Dieses Claims-Set kann der Aussteller signieren und/oder verschl√ºsseln. Nachfolgend findet sich ein Beispiel f√ºr ein signiertes JWT. Es besteht aus drei BASE64-codierten Abschnitten, die durch einen Punkt zu trennen sind. Zur besseren Lesbarkeit wurden in diesem Listing Zeilenumbr√ºche eingef√ºgt und der zweite und dritte Teil unter Verwendung von Auslassungszeichen abgek√ºrzt.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9
.
eyJuYmYiOjEz[...]BlbmlkIn0
.
Nt5pBRqGvDFn[...]1205awFjw
</code></pre></div></div>

<p>Der erste Teil beinhaltet ein JSON-Objekt, welches den Header des JWT repr√§sentiert, der zweite Teil das Claims-Set und der dritte Teil die Signatur. Der Header des betrachteten JWT gestaltet sich wie folgt:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="nl">"typ"</span><span class="p">:</span><span class="s2">"JWT"</span><span class="p">,</span><span class="nl">"alg"</span><span class="p">:</span><span class="s2">"RS256"</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Interessant ist hierbei die Eigenschaft <code class="language-plaintext highlighter-rouge">alg</code>, die den Algorithmus, der zur Erstellung der Signatur verwendet wurde, widerspiegelt. RS256 bedeutet, dass der Aussteller aus dem zu signierenden Claims-Set mit SHA-256 einen Hash-Wert errechnet und f√ºr diesen anschlie√üend mit RSA eine digitale Signatur erstellt hat. Da es sich bei RSA um ein asymmetrisches Verfahren handelt, hat der Aussteller zum signieren einen privaten Schl√ºssel verwendet. Ob die Signatur korrekt ist, kann nun jeder mit dem dazu passenden √∂ffentlichen Schl√ºssel pr√ºfen.</p>

<p>Das nachfolgende Listing zeigt das Claims-Set, welches sich im zweiten Teil des JWT befindet:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"nbf"</span><span class="p">:</span><span class="mi">1388357979</span><span class="p">,</span><span class="w">
    </span><span class="nl">"exp"</span><span class="p">:</span><span class="mi">1388444379</span><span class="p">,</span><span class="w">
    </span><span class="nl">"aud"</span><span class="p">:[</span><span class="w">
        </span><span class="s2">"http://service"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"http://partner-authsvc"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"http://myClient"</span><span class="p">],</span><span class="w">
    </span><span class="nl">"iss"</span><span class="p">:</span><span class="s2">"http://authsvc"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"sub"</span><span class="p">:</span><span class="s2">"3ca4ccc8"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="s2">"Manfred Steyer"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"role"</span><span class="p">:</span><span class="s2">"Manager"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"company"</span><span class="p">:</span><span class="s2">"ACME"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Die Claims <code class="language-plaintext highlighter-rouge">nbf</code> (Not Before) und <code class="language-plaintext highlighter-rouge">exp</code> (Expiration Time), die einen UNIX-Timestamp (Sekunden seit 1. 1. 1970, 0 Uhr GMT) beinhalten, geben die Zeitspanne an, in der das Token g√ºltig ist. Die Audience des Tokens findet sich im Claim <code class="language-plaintext highlighter-rouge">aud</code>. Es handelt sich dabei um ein JSON-Array mit den einzelnen Parteien, f√ºr die das Token ausgestellt wurde. Wird ein JWT nur f√ºr eine Partei ausgestellt, kann dieses Claim auch nur aus einem String mit dem Bezeichner dieser Partei bestehen. Der Aussteller des Tokens findet sich im Claim <code class="language-plaintext highlighter-rouge">iss</code> (Issuer) wieder und das Claim <code class="language-plaintext highlighter-rouge">sub</code> repr√§sentiert das Subjekt, welches durch das vorliegende Claims-Set beschrieben wird. Im betrachteten Fall handelt es sich hierbei um eine Benutzer-ID. Die restlichen Claims beinhalten den Namen (<code class="language-plaintext highlighter-rouge">name</code>), die Firma (<code class="language-plaintext highlighter-rouge">company</code>) und die Rolle (<code class="language-plaintext highlighter-rouge">role</code>) des beschriebenen Benutzers. Die ersten f√ºnf Claims m√ºssen laut dem zur Drucklegung dieses Buches g√ºltigen Draft zu OpenID Connect im JWT vorkommen.</p>

<p>W√§hrend sich Aussteller und Konsumenten von Claims bilateral auf die zu verwendenden Claim-Namen einigen k√∂nnen, macht es Sinn, zu pr√ºfen, ob es f√ºr den gew√ºnschten Zweck bereits offiziell definierte Namen gibt, um Kollisionen sowie Missverst√§ndnisse zu vermeiden. Eine gute erste Anlaufstelle daf√ºr ist die <a href="http://openid.net/connect" rel="noreferrer noopener" target="_blank">OpenID Connect-Spezifikation</a>. Dar√ºber hinaus kann der Aussteller auch √∂ffentliche Bezeichner, zum Beispiel URLs, als Namen f√ºr Claims heranziehen.</p>

<h3 id="protokoll-fl√ºsse-flows">Protokoll-Fl√ºsse (Flows)</h3>

<p>F√ºr verschiedene Anwendungsf√§lle definieren OAuth 2 und OIDC sogenannte Flows. Diese legen fest, welche Nachrichten auszutauschen sind, damit der Client die erw√§hnten Tokens erh√§lt. Das aktuelle <a href="https://tools.ietf.org/html/draft-ietf-oauth-security-topics-13" rel="noreferrer noopener" target="_blank">Best Current Practice Dokument</a> der OAuth-Working-Group empfiehlt den sogenannten Authorization Code Flow in Kombination mit dem Verfahren <a href="https://oauth.net/2/pkce/" rel="noreferrer noopener" target="_blank">PKCE</a> f√ºr Single Page Applications. Darauf ist auch bei der Konfiguration des gew√§hlten Authorization Servers zu achten.</p>

<p>Wer sich f√ºr die Protokoll-Details dieses Flows interessiert, wird in der <a href="https://oauth.net/2/" rel="noreferrer noopener" target="_blank">OAuth 2 Spezifikation</a> f√ºndig. Dieser Artikel nutzt zur Automatisierung der damit einhergehenden Details die Bibliothek <a href="https://www.npmjs.com/package/angular-oauth2-oidc" rel="noreferrer noopener" target="_blank">angular-oauth2-oidc</a>, sodass man sich damit nicht belasten muss.</p>

<h3 id="umsetzung-in-angular">Umsetzung in Angular</h3>

<p>Die Bibliothek <a href="https://www.npmjs.com/package/angular-oauth2-oidc" rel="noreferrer noopener" target="_blank">angular-oauth2-oidc</a> erfreut sich einer weiten Verbreitung und wurde mit mehreren verschiedenen Authorization Servern getestet, um sicherzustellen, dass keine √úberanpassung an einen bestimmten Hersteller stattfindet. Dabei handelt es sich um den <a href="https://identityserver.io/" rel="noreferrer noopener" target="_blank">IdentityServer</a> f√ºr .NET, <a href="https://www.keycloak.org/" rel="noreferrer noopener" target="_blank">Keycloak</a> von RedHat und der Cloud-L√∂sung <a href="https://auth0.com/" rel="noreferrer noopener" target="_blank">Auth0</a>. Au√üerdem ist sie von der <a href="https://openid.net/foundation/" rel="noreferrer noopener" target="_blank">OpenId Connect Foundation</a> zertifiziert, was zu weiterem Vertrauen f√ºhrt.</p>

<p>Die nachfolgenden Ausf√ºhrungen nutzen eine Identity-Server-Instanz, die ich zu Testzwecken in der Azure-Cloud betreibe.</p>

<p>Nach der Installation mit npm (<code class="language-plaintext highlighter-rouge">npm install angular-oauth2-oidc</code>) l√§sst sie sich in das Hauptmodul einer Angular-Anwendung importieren:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">@</span><span class="nd">NgModule</span><span class="p">({</span>
  <span class="na">imports</span><span class="p">:</span> <span class="p">[</span>
    <span class="nx">BrowserModule</span><span class="p">,</span>
    <span class="nx">HttpClientModule</span><span class="p">,</span>
    <span class="nx">OAuthModule</span><span class="p">.</span><span class="nf">forRoot</span><span class="p">({</span>
      <span class="na">resourceServer</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">sendAccessToken</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="na">allowedUrls</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">http://www.angular.at/api/</span><span class="dl">'</span><span class="p">]</span>
      <span class="p">}</span>
    <span class="p">}),</span>
  <span class="p">],</span>
  <span class="p">[</span><span class="err">‚Ä¶</span><span class="p">]</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nc">AppModule</span> <span class="p">{}</span>
</code></pre></div></div>

<p>Der Parameter <code class="language-plaintext highlighter-rouge">sendAccessToken</code> gibt an, dass die Bibliothek das abgerufene Access-Token bei jedem mit Angular durchgef√ºhrten HTTP-Anfrage anh√§ngen soll. Dazu kommt intern ein <code class="language-plaintext highlighter-rouge">HttpInterceptor</code> zum Einsatz. Damit das Token nicht aus Versehen an die falschen APIs gesendet werden, m√ºssen jene, die es erhalten d√ºrfen, im Array <code class="language-plaintext highlighter-rouge">allowedUrls</code> eingetragen werden. Hierzu reicht das Hinterlegen eines Pr√§fixes. Im betrachteten Fall erhalten alle APIs, deren URLs mit <code class="language-plaintext highlighter-rouge">http://www.angular.at/api/</code> beginnen, das Token.</p>

<p>An dieser Stelle soll betont werden, dass die hier betrachteten Mechanismen nur bei Einsatz von HTTPS als sicher angesehen werden k√∂nnen. Aus Gr√ºnden der Vereinfachung kommt bei dem hier gezeigten Beispiel, das lediglich der Veranschaulichung dient, lediglich HTTP zum Einsatz.</p>

<p>Um der Bibliothek Eckdaten wie die URL des Authorization Servers mitzuteilen, ist ein Konfigurationsobjekt anzulegen.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">AuthConfig</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">angular-oauth2-oidc</span><span class="dl">'</span><span class="p">;</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">authConfig</span><span class="p">:</span> <span class="nx">AuthConfig</span> <span class="o">=</span> <span class="p">{</span>

  <span class="c1">// Url des Authorization-Servers</span>
  <span class="na">issuer</span><span class="p">:</span> <span class="dl">'</span><span class="s1">http://idsvr4.azurewebsites.net</span><span class="dl">'</span><span class="p">,</span>

  <span class="c1">// Url der Angular-Anwendung</span>
  <span class="c1">// An diese URL sendet der Authorization-Server den Access Code</span>
  <span class="na">redirectUri</span><span class="p">:</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">origin</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">/index.html</span><span class="dl">'</span><span class="p">,</span>

  <span class="c1">// Name der Angular-Anwendung</span>
  <span class="na">clientId</span><span class="p">:</span> <span class="dl">'</span><span class="s1">spa</span><span class="dl">'</span><span class="p">,</span>

  <span class="c1">// Rechte des Benutzers, die die Angular-Anwendung wahrnehmen m√∂chte</span>
  <span class="na">scope</span><span class="p">:</span> <span class="dl">'</span><span class="s1">openid profile email offline_access api</span><span class="dl">'</span><span class="p">,</span>

  <span class="c1">// Code Flow (PKCE ist standardm√§√üig bei Nutzung von Code Flow aktiviert)</span>
  <span class="na">responseType</span><span class="p">:</span> <span class="dl">'</span><span class="s1">code</span><span class="dl">'</span>

<span class="p">}</span>
</code></pre></div></div>

<p>Die <code class="language-plaintext highlighter-rouge">redirectUri</code> und die <code class="language-plaintext highlighter-rouge">clientId</code> m√ºssen gemeinsam beim Authorization-Server hinterlegt sein. Existiert f√ºr diese Kombination kein Eintrag, muss der Authorization-Server die Anfrage aus Sicherheitsgr√ºnden ablehnen. Ansonsten k√∂nnte ein Angreifer vorgeben, ein bestimmter Client zu sein.</p>

<p>Die Scopes <code class="language-plaintext highlighter-rouge">openid</code>, <code class="language-plaintext highlighter-rouge">profile</code> und <code class="language-plaintext highlighter-rouge">email</code> sind durch OIDC definiert und beschrieben die Informationen, die die Anwendung √ºber den Benutzer bekommen m√∂chte. Im einfachsten Fall wird nur <code class="language-plaintext highlighter-rouge">openid</code> angefordert. Das h√§tte zur Folge, dass die Anwendung lediglich die Id des Benutzers erh√§lt. Hinter <code class="language-plaintext highlighter-rouge">profile</code> verbergen sich Profilinformationen wie Vorname oder Nachname und hinter <code class="language-plaintext highlighter-rouge">email</code> ‚Äì wenig √ºberraschend ‚Äì die Email-Adresse des Benutzers, aber auch die Tatsache, ob diese bereits durch eine Test-Email verifiziert wurde.</p>

<p>Der Scope <code class="language-plaintext highlighter-rouge">offline_access</code> gibt an, dass die Anwendung ein Refresh-Token haben m√∂chte. Damit l√§sst sich ein neues Access Token anfordern, wenn das bestehende abgelaufen ist. Aus Sicherheitsgr√ºnden sind Access Tokens in der Regel kurzlebig - eine Lebensdauer von lediglich 10 bis 20 Minuten ist keine Seltenheit.</p>

<p>Bei <code class="language-plaintext highlighter-rouge">api</code> handelt es sich hingegen um einen benutzerspezifischen Scope. Im betrachteten Fall gibt er an, dass der Client im Namen des Benutzers auf die Demo-API zugreifen darf. In der Regel gibt es pro API solch einen Scope, wobei sich diese auch auf (Teile von) Use-Cases herunterbrechen oder zu √ºbergeordneten Scopes aggregieren lassen.</p>

<p>Laut OAuth 2 m√ºssen Benutzer diesen Scopes ihre Zustimmung erteilen. Somit k√∂nnten sie festlegen, dass ein Client doch nicht in ihrem Namen auf eine bestimmte API zugreifen d√ºrfen oder ihre Email-Adresse erh√§lt. Alle gew√§hrten Scopes finden sich im Access-Token wieder und der Ressource-Server kann so pr√ºfen, welche Rechte der Benutzer dem Client delegiert hat.</p>

<p>W√§hrend ein solches explizites Zustimmen bei Consumer-Anwendungen wichtig ist, gestaltet es sich bei Gesch√§ftsanwendungen h√§ufig als l√§stig. Deswegen erlauben viele Produkte, diesen sogenannten <em>Consent</em> zu √ºberspringen. In diesem Fall gehen sie davon aus, dass alle Scopes best√§tigt wurden.</p>

<p>Wichtig ist an dieser Stelle auch, dass die Scopes nicht die Rechte des Benutzers widerspiegeln, sondern nur jene Rechte, die der Benutzer der Anwendung √ºbertr√§gt.</p>

<p>Damit die Bibliothek das Konfigurations-Objekt verwendet, ist es beim Programmstart zu √ºbergeben:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">@</span><span class="nd">Component</span><span class="p">({</span> <span class="err">‚Ä¶</span> <span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nc">AppComponent</span> <span class="p">{</span>

  <span class="nf">constructor</span><span class="p">(</span><span class="k">private</span> <span class="nx">oauthService</span><span class="p">:</span> <span class="nx">OAuthService</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">oauthService</span><span class="p">.</span><span class="nf">configure</span><span class="p">(</span><span class="nx">authConfig</span><span class="p">);</span>
    <span class="nx">oauthService</span><span class="p">.</span><span class="nf">loadDiscoveryDocumentAndTryLogin</span><span class="p">();</span>
    <span class="nx">oauthService</span><span class="p">.</span><span class="nf">setupAutomaticSilentRefresh</span><span class="p">();</span>
  <span class="p">}</span>

<span class="p">}</span>
</code></pre></div></div>

<p>Die Methode <code class="language-plaintext highlighter-rouge">loadDiscoveryDocumentAndTryLogin</code> l√§dt weitere Konfigurationsdaten vom Authorization Server. Dieses als Discovery bekannte Verfahren ist durch OIDC standardisiert. Danach pr√ºft diese Methode, ob sich bereits ein Access-Code in der Url befindet. In diesem Fall versucht sie, den Flow abzuschlie√üen, was im Erfolgsfall zum Erhalt der diskutierten Tokens f√ºhrt.</p>

<p>Mit <code class="language-plaintext highlighter-rouge">setupAutomaticSilentRefresh</code> gibt die Anwendung an, dass die Token automatisch zu erneuern sind. Danach wird es sehr geradlinig. Die Methode <code class="language-plaintext highlighter-rouge">initLoginFlow</code> beginnt mit dem Code-Flow und leitet den Benutzer zu Authorization-Server um:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">this</span><span class="p">.</span><span class="nx">oauthService</span><span class="p">.</span><span class="nf">initLoginFlow</span><span class="p">();</span>
</code></pre></div></div>

<p>Mit der Methode <code class="language-plaintext highlighter-rouge">logOut</code> l√§sst sich der Benutzer hingegen wieder abmelden:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">this</span><span class="p">.</span><span class="nx">oauthService</span><span class="p">.</span><span class="nf">logOut</span><span class="p">();</span>
</code></pre></div></div>

<p>Das bedeutet, dass zum einen die Tokens verworfen werden, aber auch, dass durch eine Umleitung der Benutzer beim Authorization-Server abgemeldet wird.</p>

<p>Die Methode <code class="language-plaintext highlighter-rouge">getIdentityClaims</code> liefert Key/Value-Pairs, die den Benutzer beschreiben:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">claims</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">oauthService</span><span class="p">.</span><span class="nf">getIdentityClaims</span><span class="p">();</span>
<span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">claims</span><span class="p">)</span> <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
<span class="k">return</span> <span class="nx">claims</span><span class="p">[</span><span class="dl">'</span><span class="s1">given_name</span><span class="dl">'</span><span class="p">];</span>
</code></pre></div></div>

<p>Um die Funktionsweise zu pr√ºfen, reichtes, nach dem Anmelden die Claims zu beziehen sowie einen HTTP-Service aufzurufen. Im letzteren Fall sollte die Bibliothek das Access-Token √ºber den HTTP-Header Authorization √ºbersenden.</p>

<h2 id="fazit">Fazit</h2>

<p>OAuth 2 ist ein etablierter Industriestandard zum Anfordern von Tokens, die einem Client im Namen des Benutzers Zugriff auf das Backend gew√§hren. OpenId Connect baut darauf auf und versorgt den Client mit Informationen √ºber den Benutzer.</p>

<p>Durch den Einsatz von Token ergeben sich einige Vorteile: Der Benutzer kann sich mit einem zentralen Konto bei mehreren Anwendungen anmelden und die Anwendung muss sich nicht um das Verwalten eigener Konten k√ºmmern. Im Gegensatz zum Einsatz von Cookies k√∂nnen verschiedene Origins zum Einsatz kommen und XSRF Attacken sind ausgeschlossen.</p>

<hr>
<p>Manfred Steyer ist Trainer und Berater mit Fokus auf Angular sowie Google Developer Expert und Trusted Collaborator im Angular-Team. Er schreibt f√ºr O‚ÄôReilly, das deutsche Java-Magazin und Heise Developer. Unter https://angulararchitects.io bietet er Angular Schulungen und Beratung im gesamten deutschsprachigen Raum an.</p>

        </div>

        <div class="text-end">
          <a class="btn btn-sm btn-link link-secondary" href="https://github.com/workshops-de/angular.de/edit/master/_posts/2020-07-27-oauth-odic-plugin/2020-07-27-oauth-odic-plugin.md" target="_blank" rel="noopener noreferrer nofollow">
            üêõ Diesen Artikel auf GitHub verbessern
          </a>
        </div>
      </div>
      <div class="col-lg-4 d-none d-lg-block">
        <div class="position-sticky c-top-4 ms-2">
          <p class="text-muted text-uppercase"><small>Inhaltsverzeichnis</small></p>
          <nav id="toc" data-toggle="toc"></nav>
          <!-- <hr> -->
          <!-- <div>
            <div class="h5 mb-2">Email Newsletter</div>
            <p class="small mb-2">Um alle Neuigkeiten zu erfahren, abonniere hier unseren Newsletter!</p>
            <a class="btn btn-sm btn-primary" href="/newsletter/redirect/article" target="_blank">
              Newsletter abonnieren
            </a>
          </div> -->

          <div class="mt-4">
            <a href="https://ng-de.org?utm_source=angular_de&utm_campaign=conference2025&utm_medium=portal&utm_content=article_sidebar"
               target="_blank"
               class="d-block text-decoration-none">
              <div class="card border-0 shadow-sm h-100" style="transition: all 150ms;">
                <img src="/assets/img/ngde-conf-ad.png"
                     class="card-img-top rounded-top"
                     alt="NG-DE Conference - November 5-7, 2025"
                     style="object-fit: cover; height: 100%;">
                <div class="card-body p-3">
                  <h5 class="card-title text-dark fw-bold mb-2">NG-DE Conference</h5>
                  <p class="card-text text-muted small mb-2">
                    The community-driven Angular conference in Germany
                  </p>
                  <div class="d-flex align-items-center mb-2">
                    <i class="fa fa-calendar text-primary me-2" style="width: 12px;"></i>
                    <small class="text-muted">November 5-7, 2025</small>
                  </div>
                  <div class="d-flex align-items-center mb-3">
                    <i class="fa fa-map-marker text-primary me-2" style="width: 12px;"></i>
                    <small class="text-muted">Berlin</small>
                  </div>
                  <div class="d-flex justify-content-between align-items-center">
                    <span class="btn btn-primary btn-sm fw-bold text-uppercase" style="font-size: 0.7rem; letter-spacing: 0.05em; padding: 0.375rem 0.75rem;">
                      Get your ticket now!
                    </span>
                  </div>
                </div>
              </div>
            </a>
          </div>

          <style>
            .mt-4 a:hover .card {
              box-shadow: 0 0 4px 0 rgba(0,0,0,0.35) !important;
            }

            .mt-4 a:hover .card-title {
              color: #0d6efd !important;
            }
          </style>
        </div>
      </div>
    </div>
    <div class="row mt-4">
      <div class="col-md-12 col-lg-8">
        <!-- author info -->

<div class="row">
  <div class="col-sm-3 col-md-2">
    <span>
      <img alt="Manfred Steyer" class="shadow-sm rounded img-fluid lazy"
      src="/shared/assets/img/placeholder-image.svg"
      
      data-src="/assets/img/avatars/manfred-steyer.jpg"
      data-srcset="/assets/img/avatars/manfred-steyer.jpg"
      
      >
    </span>
  </div>
  <div class="col-sm-9 col-md-10">
    <p class="h5 text-truncate mb-2">
      Manfred Steyer
    </p>
    
    <div>
      
      
        <a href="https://github.com/manfredsteyer" class="btn btn-sm btn-outline-secondary" target="_blank">Github</a>
      
      
        <a href="https://twitter.com/ManfredSteyer" class="btn btn-sm btn-outline-secondary" target="_blank">Twitter</a>
      
      
    </div>
  </div>
</div>

        
      </div>
    </div>
  </article>

  <div class="container-fluid">
    <div class="row justify-content-md-center no-gutters mt-6">
      





  
  

  

  
    <div class="col-sm-6 p-0">
  <a class="ratio ratio-16x9 d-flex align-items-center c-img-bg-backdrop c-bg-img-cover-center lazy"
    style="background-image: url('/shared/assets/img/placeholder-image.svg');"
    href="/artikel/ng-de-conference-2025-ankuendigung/"
    data-style="background-image: url('/artikel/ng-de-conference-2025-ankuendigung/header.jpg')"
    >
    <div class="d-flex flex-column align-items-center justify-content-center px-4">
      <div class="text-center w-100 h2 text-white">
        NG-DE Conference 2025 wieder in Berlin
      </div>
      <button class="btn btn-outline-light">Hier weiterlesen</button>
    </div>
  </a>
</div>


    
    
  



  
  

  

  
    <div class="col-sm-6 p-0">
  <a class="ratio ratio-16x9 d-flex align-items-center c-img-bg-backdrop c-bg-img-cover-center lazy"
    style="background-image: url('/shared/assets/img/placeholder-image.svg');"
    href="/artikel/angular-tutorial-deutsch/"
    data-style="background-image: url('/artikel/angular-tutorial-deutsch/header.jpg')"
    >
    <div class="d-flex flex-column align-items-center justify-content-center px-4">
      <div class="text-center w-100 h2 text-white">
        Angular 20 Tutorial f√ºr Einsteiger
      </div>
      <button class="btn btn-outline-light">Hier weiterlesen</button>
    </div>
  </a>
</div>


    
    
      

    </div>
  </div>
</main>

  
<div class="newsletter-section d-print-none py-5">
  <div class="container">
    <p class="lead text-center">Du m√∂chtest immer auf dem aktuellsten Stand sein? - Melde Dich f√ºr unseren Newsletter an!</p>
    <div class="text-center">
      <a class="btn btn-primary" href="/newsletter/redirect/footer" target="_blank">
        Jetzt f√ºr Neuigkeiten zu Angular anmelden!
      </a>
    </div>
  </div>
</div>


  <footer>
  <div class="container">
    <div class="row">
      <div class="col-6 col-sm-3 mb-2">
        <div class="h4 mb-2">Angular.DE</div>
        <small>
          <span class="fw-bolder">Powered by <a href="https://workshops.de?utm_source=angular_de&utm_campaign=crossmarketing_permanent&utm_medium=portal&utm_content=footer_nav">Workshops.DE</a></span>.
        </small>
      </div>
      <div class="col-6 col-sm-3 mb-2">
        <div class="h6 text-uppercase">Navigation</div>
        <ul class="footer-nav">
          <li><a href="/artikel/">Artikel</a></li>
          <li><a href="/tutorials/">Tutorials</a></li>
          <li><a href="/schulungen/">Schulungen</a></li>
          <li><a href="https://workshops.de/seminare-schulungen-kurse/angular-lifetime?utm_source=angular_de&utm_campaign=crossmarketing_permanent&utm_medium=portal&utm_content=footer_nav" target="_blank">Lifetime</a></li>
          <li><a href="/meetups/">Meetups</a></li>
          <li><a href="/team/">Team</a></li>
          <li><a href="/presskit/">Presskit</a></li>
        </ul>
      </div>
      <div class="col-6 col-sm-3 mb-2">
        <div class="h6 text-uppercase">Communities</div>
        <ul class="footer-nav">
          <li><a href="https://reactjs.de?utm_source=angular_de&utm_campaign=crossmarketing_permanent&utm_medium=portal&utm_content=footer_nav" target="_blank">ReactJS.DE</a></li>
          <li><a href="https://vuejs.de?utm_source=angular_de&utm_campaign=crossmarketing_permanent&utm_medium=portal&utm_content=footer_nav" target="_blank">VueJS.DE</a></li>
          <li><a href="https://cloudnative.eu?utm_source=angular_de&utm_campaign=crossmarketing_permanent&utm_medium=portal&utm_content=footer_nav" target="_blank">CloudNative.EU</a></li>
          <li><a href="https://a11y-masterclass.de?utm_source=angular_de&utm_campaign=crossmarketing_permanent&utm_medium=portal&utm_content=footer_nav" target="_blank">a11y Masterclass</a></li>
          <li><a href="https://workshops.de?utm_source=angular_de&utm_campaign=crossmarketing_permanent&utm_medium=portal&utm_content=footer_nav" target="_blank">Workshops.DE</a></li>
          <li><a href="https://www.coding-bootcamps.eu?utm_source=angular_de&utm_campaign=crossmarketing_permanent&utm_medium=portal&utm_content=footer_nav" target="_blank">Coding Bootcamp Europe</a></li>
          <li><a href="https://ng-de.org?utm_source=angular_de&utm_campaign=conference2025&utm_medium=portal&utm_content=footer_nav" target="_blank">NG-DE Konferenz</a></li>
        </ul>
      </div>
      <div class="col-6 col-sm-3 mb-2">
        <div class="h6 text-uppercase">Folge uns hier</div>
        <ul class="footer-nav">
          <li>
            <a href="https://twitter.com/angular_de" target="_blank" rel="noopener">Twitter</a>
          </li>
          <li>
            <a href="https://github.com/workshops-de" target="_blank" rel="noopener">GitHub</a>
          </li>
          <li><a href="/feed.xml" target="_blank" rel="nofollow">RSS-Feed</a></li>
        </ul>
      </div>
    </div>
    <hr />
    <div class="row align-items-center">
      <div class="col-6 small">
        Copyright ¬© 2025 Symetics GmbH
      </div>
      <div class="col-6">
        <ul class="nav justify-content-end">
          <li class="nav-item">
            <a class="nav-link" href="/impressum/">Impressum</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/datenschutz/">Datenschutz</a>
          </li>
        </ul>
      </div>
    </div>
  </div>
</footer>

  
  

  

  
  


  <script type="text/javascript">
  (() => {

    function lazyLoadImages() {
      var lazyImages = [].slice.call(document.querySelectorAll("img.lazy"));

      if ("IntersectionObserver" in window) {
        let lazyImageObserver = new IntersectionObserver(function(entries, observer) {
          entries.forEach(function(entry) {
            if (entry.isIntersecting) {
              let lazyImage = entry.target;
              lazyImage.src = lazyImage.dataset.src;
              lazyImage.srcset = lazyImage.dataset.srcset;
              lazyImage.classList.remove("lazy");
              lazyImageObserver.unobserve(lazyImage);
            }
          });
        });

        lazyImages.forEach(function(lazyImage) {
          lazyImageObserver.observe(lazyImage);
        });
      } else {
        // Possibly fall back to a more compatible method here
        lazyImages.forEach(function(lazyImage) {
          lazyImage.src = lazyImage.dataset.src;
          lazyImage.srcset = lazyImage.dataset.srcset;
          lazyImage.classList.remove("lazy");
        });
      }
    }

    function lazyLoadBackgroundImages() {
      var lazyImages = [].slice.call(document.querySelectorAll("a.lazy"));

      if ("IntersectionObserver" in window) {
        let lazyImageObserver = new IntersectionObserver(function(entries, observer) {
          entries.forEach(function(entry) {
            if (entry.isIntersecting) {
              let lazyImage = entry.target;
              lazyImage.style = lazyImage.dataset.style;
              lazyImage.classList.remove("lazy");
              lazyImageObserver.unobserve(lazyImage);
            }
          });
        });

        lazyImages.forEach(function(lazyImage) {
          lazyImageObserver.observe(lazyImage);
        });
      } else {
        // Possibly fall back to a more compatible method here
        lazyImages.forEach(function(lazyImage) {
          lazyImage.src = lazyImage.dataset.src;
          lazyImage.srcset = lazyImage.dataset.srcset;
          lazyImage.classList.remove("lazy");
        });
      }
    }

    document.addEventListener("DOMContentLoaded", function() {
      lazyLoadImages();
      lazyLoadBackgroundImages();
      });
  })();
</script>

  <!-- JavaScript -->
  <script src="/shared/assets/js/vendor/jquery-3.2.1.slim.min.js"></script>
  <script src="/shared/assets/js/vendor/bootstrap.min.js"></script>
  <script src="/shared/assets/js/vendor/fp-3.0.0.min.js"></script>
  <script src="/shared/assets/js/vendor/headroom.min.js"></script>
  <script src="/shared/assets/js/app.js"></script>
  
  <script src="/shared/assets/js/vendor/bootstrap-toc-1.0.0.min.js"></script>
  
  
  
</body>

</html>
