---
import { siteConfig } from '../config/site';

interface Props {
  title: string;
  description?: string;
  url: string;
  image?: string;
  type?: string;
  publishedTime?: Date;
  author?: string;
  slug?: string; // For generated OG images
}

const {
  title,
  description,
  url,
  image,
  type = 'website',
  publishedTime,
  author,
  slug
} = Astro.props;

const siteUrl = Astro.site?.toString().replace(/\/$/, '') || siteConfig.url;
const defaultImage = `${siteUrl}/assets/img/og-default.jpg`;

// Priority: 1. Generated OG image (if slug provided), 2. Custom image, 3. Default
let ogImage: string;
if (slug && type === 'article') {
  // Use generated OG image for articles
  ogImage = `${siteUrl}/og/${slug}.jpg`;
} else if (image) {
  ogImage = image.startsWith('http') ? image : `${siteUrl}${image}`;
} else {
  ogImage = defaultImage;
}
---

<!-- Open Graph / Facebook -->
<meta property="og:type" content={type}>
<meta property="og:url" content={url}>
<meta property="og:title" content={title}>
{description && <meta property="og:description" content={description} />}
<meta property="og:image" content={ogImage}>
<meta property="og:site_name" content={siteConfig.title}>
<meta property="og:locale" content={`${siteConfig.language}_${siteConfig.language.toUpperCase()}`}>

{publishedTime && (
  <meta property="article:published_time" content={publishedTime.toISOString()}>
)}
{author && (
  <meta property="article:author" content={author}>
)}

<!-- Twitter -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content={`@${siteConfig.twitter_username}`}>
<meta name="twitter:url" content={url}>
<meta name="twitter:title" content={title}>
{description && <meta name="twitter:description" content={description} />}
<meta name="twitter:image" content={ogImage}>
