---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import PostCard from '../../../components/PostCard.astro';
import Pagination from '../../../components/Pagination.astro';
import { getCollection } from 'astro:content';
import { siteConfig } from '../../../config/site';

const { topic } = siteConfig;

export async function getStaticPaths() {
  const allPosts = await getCollection('posts');
  const sortedPosts = allPosts.sort(
    (a, b) => b.data.published_at.getTime() - a.data.published_at.getTime()
  );

  const postsPerPage = 12;
  const totalPages = Math.ceil(sortedPosts.length / postsPerPage);

  return Array.from({ length: totalPages }, (_, i) => ({
    params: { page: String(i + 1) },
    props: {
      posts: sortedPosts.slice(i * postsPerPage, (i + 1) * postsPerPage),
      currentPage: i + 1,
      totalPages,
    },
  }));
}

const { posts, currentPage, totalPages } = Astro.props;
---

<BaseLayout
  title={`Artikel - Seite ${currentPage}`}
  description={`Alle Artikel rund um ${topic}, TypeScript und moderne Webentwicklung auf Deutsch. Seite ${currentPage} von ${totalPages}.`}
  noindex={currentPage > 1}
>
  <!-- Hero Header with Pattern Background -->
  <section class="relative py-20 md:py-28 overflow-hidden dark:bg-gray-950">
    <!-- Gradient Mesh Background (Light) -->
    <div class="absolute inset-0 dark:hidden" style="background: radial-gradient(at 20% 30%, rgba(221, 0, 49, 0.08) 0px, transparent 50%), radial-gradient(at 80% 20%, rgba(139, 92, 246, 0.1) 0px, transparent 50%), radial-gradient(at 40% 80%, rgba(59, 130, 246, 0.08) 0px, transparent 50%), radial-gradient(at 90% 70%, rgba(236, 72, 153, 0.06) 0px, transparent 50%), linear-gradient(180deg, #fafafa 0%, #f5f5f5 100%);"></div>
    <!-- Gradient Mesh Background (Dark) -->
    <div class="absolute inset-0 hidden dark:block" style="background: radial-gradient(at 20% 30%, rgba(133, 20, 245, 0.2) 0px, transparent 50%), radial-gradient(at 80% 20%, rgba(139, 92, 246, 0.15) 0px, transparent 50%), radial-gradient(at 40% 80%, rgba(59, 130, 246, 0.12) 0px, transparent 50%);"></div>
    <!-- Dot Grid Pattern Overlay -->
    <div class="absolute inset-0 dark:opacity-30" style="background-image: radial-gradient(circle, rgba(0, 0, 0, 0.08) 1px, transparent 1px); background-size: 24px 24px;"></div>

    <div class="container mx-auto px-4 relative text-center z-10">
      <h1 class="text-5xl md:text-6xl lg:text-7xl text-gray-900 dark:text-white mb-4">
        <span class="block">News, Tutorials,</span>
        <span class="text-primary">Insights.</span>
      </h1>
      <p class="text-xl text-gray-600 dark:text-gray-400 max-w-2xl mx-auto">
        News, Tutorials und Best Practices von<br />
        unserer {topic}-Community.
      </p>
    </div>
  </section>

  <!-- Articles Grid -->
  <section class="py-16 dark:bg-gray-950">
    <div class="container mx-auto px-4">
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {posts.map(post => (
          <PostCard post={post} showReadingTime={true} />
        ))}
      </div>

      <Pagination
        currentPage={currentPage}
        totalPages={totalPages}
        basePath="/artikel"
      />
    </div>
  </section>
</BaseLayout>
